CREATE OR REPLACE VIEW 
S#MANDANT#_WA_ATOM 
(
ID_BEWEGUNG_STATION,
ID_ADRESSE_BASIS,
ID_ADRESSE_STATION,
ID_ADRESSE_BESITZER,
WIEGEKARTENKENNER,
ID_WIEGEKARTE,
MENGENVORZEICHEN,
KONTROLLMENGE,
NAME1,
NAME2,
NAME3,
STRASSE,
HAUSNUMMER,
LAENDERCODE,
PLZ,
ORT,
ORTZUSATZ,
OEFFNUNGSZEITEN,
BESTELLNUMMER,
TELEFON,
FAX,
ID_BEWEGUNG_ATOM,
LEISTUNGSDATUM,
LEISTUNGSDATUM_MONAT_JAHR,
ID_ARTIKEL,
ID_ARTIKEL_BEZ,
ARTBEZ1,
ARTBEZ2,
PLANMENGE,
MENGE,
ABZUG_MENGE,
PRUEFUNG_MENGE,
PRUEFUNG_MENGE_AM,
PRUEFUNG_MENGE_VON,
E_PREIS,
E_PREIS_RESULT_NETTO_MGE,
ABRECHENBAR,
ABGERECHNET,
ID_VPOS_KON,
ID_VPOS_STD,
KONTRAKTZWANG,
KONTRAKTZWANG_AUS_VON,
KONTRAKTZWANG_AUS_GRUND,
KONTRAKTZWANG_AUS_AM,
POSTENNUMMER,
STEUERSATZ,
EU_STEUER_VERMERK,
BEMERKUNG,
BEMERKUNG_SACHBEARBEITER,
BUCHUNGSNUMMER,
NOTIFIKATION_NR,
LIEFERINFO_TPA,
PREISERMITTLUNG,
NATIONALER_ABFALL_CODE,
ORDNUNGSNUMMER_CMR,
ZEITSTEMPEL,
SETZKASTEN_KOMPLETT,
POSNR,
GESAMTPREIS,
GPREIS_ABZ_MGE,
GPREIS_ABZ_AUF_NETTOMGE,
GPREIS_ABZ_VORAUSZAHLUNG,
E_PREIS_RESULT_BRUTTO_MGE,
MENGE_NETTO,
ID_ZAHLUNGSBEDINGUNGEN,
LIEFERBEDINGUNGEN,
ID_LAGER_KONTO,
ID_BEWEGUNG_VEKTOR,
VARIANTE,
WARENKLASSE,
ID_VPOS_TPA_FUHRE,
ID_EINHEIT,
KOSTEN_TRANSPORT_WE,
KOSTEN_PRODUKT_WE,
KOSTEN_TRANSPORT_WA,
KOSTEN_PRODUKT_WA,
ID_ADRESSE_STATION_GEGENUEBER,
KENNUNGSFELD_WE_WA
)
AS 
(


SELECT

--felder aus jt_bewegung_station
BS.ID_BEWEGUNG_STATION,
NVL(LA.ID_ADRESSE_BASIS,BS.ID_ADRESSE) AS ID_ADRESSE_FIRMA,
BS.ID_ADRESSE,
BS.ID_ADRESSE_BESITZER,
BS.WIEGEKARTENKENNER,
BS.ID_WIEGEKARTE,
BS.MENGENVORZEICHEN,
BS.KONTROLLMENGE,
BS.NAME1,
BS.NAME2,
BS.NAME3,
BS.STRASSE,
BS.HAUSNUMMER,
BS.LAENDERCODE,
BS.PLZ,
BS.ORT,
BS.ORTZUSATZ,
BS.OEFFNUNGSZEITEN,
BS.BESTELLNUMMER,
BS.TELEFON,
BS.FAX,

--felder aus jt_bewegung_atom
BA.ID_BEWEGUNG_ATOM,
BA.LEISTUNGSDATUM,
TO_CHAR(BA.LEISTUNGSDATUM,'YYYY-MM') AS LEISTUNGSDATUM_MONAT_JAHR,
BA.ID_ARTIKEL,
BA.ID_ARTIKEL_BEZ,
BA.ARTBEZ1,
BA.ARTBEZ2,
BA.PLANMENGE,
BA.MENGE,
BA.ABZUG_MENGE,
BA.PRUEFUNG_MENGE,
BA.PRUEFUNG_MENGE_AM,
BA.PRUEFUNG_MENGE_VON,
BA.E_PREIS,
BA.E_PREIS_RESULT_NETTO_MGE,
BA.ABRECHENBAR,
BA.ABGERECHNET,
BA.ID_VPOS_KON,
BA.ID_VPOS_STD,
BA.KONTRAKTZWANG,
BA.KONTRAKTZWANG_AUS_VON,
BA.KONTRAKTZWANG_AUS_GRUND,
BA.KONTRAKTZWANG_AUS_AM,
BA.POSTENNUMMER,
BA.STEUERSATZ,
BA.EU_STEUER_VERMERK,
BA.BEMERKUNG,
BA.BEMERKUNG_SACHBEARBEITER,
BA.BUCHUNGSNUMMER,
BA.NOTIFIKATION_NR,
BA.LIEFERINFO_TPA,
BA.PREISERMITTLUNG,
BA.NATIONALER_ABFALL_CODE,
BA.ORDNUNGSNUMMER_CMR,
BA.ZEITSTEMPEL,
BA.SETZKASTEN_KOMPLETT,
BA.POSNR,
BA.GESAMTPREIS,
BA.GPREIS_ABZ_MGE,
BA.GPREIS_ABZ_AUF_NETTOMGE,
BA.GPREIS_ABZ_VORAUSZAHLUNG,
BA.E_PREIS_RESULT_BRUTTO_MGE,
BA.MENGE_NETTO,
BA.ID_ZAHLUNGSBEDINGUNGEN,
BA.LIEFERBEDINGUNGEN,
BA.ID_LAGER_KONTO,

--felder aus jt_bewegung_vektor
BV.ID_BEWEGUNG_VEKTOR,
BV.VARIANTE,
BV.WARENKLASSE,

--felder aus jt_bewegung
B.ID_VPOS_TPA_FUHRE,

--felder aus artikel
ART.ID_EINHEIT,

--kosten
BV.KOSTEN_TRANSPORT_WE,
BV.KOSTEN_PRODUKT_WE,
BV.KOSTEN_TRANSPORT_WA,
BV.KOSTEN_PRODUKT_WA,


--ID_ADRESSE der GEGENSTATION des Atoms zu dieser station
(SELECT  BS2.ID_ADRESSE 
FROM JT_BEWEGUNG_STATION  BS2 
INNER JOIN JT_BEWEGUNG_ATOM BA2 ON (BS2.ID_BEWEGUNG_ATOM=BA2.ID_BEWEGUNG_ATOM)
WHERE BS2.MENGENVORZEICHEN=1 AND BA2.ID_BEWEGUNG_ATOM=BA.ID_BEWEGUNG_ATOM) AS ID_ADRESSE_STATION_GEGENUEBER,

'WA'


FROM JT_BEWEGUNG B
INNER JOIN JT_BEWEGUNG_VEKTOR   BV  ON BV.ID_BEWEGUNG = B.ID_BEWEGUNG
INNER JOIN JT_BEWEGUNG_ATOM     BA ON BA.ID_BEWEGUNG_VEKTOR = BV.ID_BEWEGUNG_VEKTOR
INNER JOIN JT_BEWEGUNG_STATION BS ON BS.ID_BEWEGUNG_ATOM = BA.ID_BEWEGUNG_ATOM
INNER JOIN JT_ADRESSE AD ON BS.ID_ADRESSE = AD.ID_ADRESSE
INNER JOIN JT_ARTIKEL ART ON BA.ID_ARTIKEL = ART.ID_ARTIKEL
LEFT OUTER JOIN JT_LIEFERADRESSE  LA  ON (LA.ID_ADRESSE_LIEFER=AD.ID_ADRESSE)
WHERE NVL(BA.DELETED,'N')='N' 
AND      NVL(BA.STORNIERT,'N')='N'
AND      NVL(BA.ABRECHENBAR,'N')='Y'
AND      NVL(BV.STATUS,'-')<>'STORNIERT'
AND      B.ID_MANDANT=#MANDANT#
AND      AD.SONDERLAGER IS  NULL
AND      BS.MENGENVORZEICHEN=-1
)
