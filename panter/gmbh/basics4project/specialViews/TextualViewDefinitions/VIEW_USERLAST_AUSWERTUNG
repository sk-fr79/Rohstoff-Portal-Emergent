CREATE OR REPLACE VIEW V#MANDANT#_USERLAST_AUSWERTUNG 
 AS (
SELECT
SUBQ.BENUTZER
,CASE WHEN NVL(INSTR(SUBQ.OPENMODULLIST,SUBQ.MODULNAME),0)>0 THEN
 'OFFEN'
 ELSE
 'ZU'
 END AS LETZTER_STATUS
,SUBQ.MODULNAME
,TO_NUMBER(SUBQ.LISTENLAENGE) AS N_LAENGE

,SUBQ.LISTENLAENGE
,SUBQ.ID_USERSETTINGS
,SUBQ.ID_USER
--,SUBQ.OPENMODULLIST
FROM
(
SELECT

S.MODULSETTINGS AS LISTENLAENGE,
(SELECT NVL(VORNAME,'<VORNAME>')||' '|| NVL(NAME1,'<NAME>') FROM JD_USER WHERE ID_USER=S.ID_USER) AS BENUTZER,
S.ID_USERSETTINGS,
S.ID_USER,
S.HASHVALUE_SESSION,
S.MODUL_KENNER,
--SUBSTRING_INDEX(S.MODUL_KENNER,'@',1) AS MODULNAME,
CASE
WHEN INSTR(S.MODUL_KENNER,CSCONVERT('@','NCHAR_CS'))>1 THEN
  SUBSTR(S.MODUL_KENNER,1,   INSTR(S.MODUL_KENNER,CSCONVERT('@','NCHAR_CS')) -1   )
ELSE
 NULL
END AS MODULNAME,

(SELECT MAX(JD_USERSETTINGS.MODULSETTINGS) FROM JD_USERSETTINGS WHERE JD_USERSETTINGS.HASHVALUE_SESSION='SESSION_HASH_USER_OPENMODULES' AND
 JD_USERSETTINGS.ID_USER=S.ID_USER) AS OPENMODULLIST

 FROM JD_USERSETTINGS S LEFT OUTER JOIN JD_USER U ON (U.ID_USER=S.ID_USER)
  WHERE S.HASHVALUE_SESSION='SESSION_HASH_USER_SAVE_LIST_SEITENLEANGE'
  AND  U.ID_MANDANT=#MANDANT#
  AND NVL(U.AKTIV,'N')='Y'
) SUBQ
WHERE SUBQ.MODULNAME IS NOT NULL
 
)