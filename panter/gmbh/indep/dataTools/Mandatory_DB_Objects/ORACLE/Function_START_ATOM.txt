CREATE OR REPLACE FUNCTION START_ATOM (id_vektor IN NUMBER)
  --ermittelt das startatom mit der physikalischen startadresse innerhalb des vektors
  RETURN  NUMBER IS
    ret number := null; 
  BEGIN
 
  if (id_vektor is not null) then
  
      SELECT 
         MIN(BA.ID_BEWEGUNG_ATOM) into ret
      FROM 
         JT_BEWEGUNG_ATOM BA
         LEFT OUTER JOIN JT_BEWEGUNG_VEKTOR_POS  VP ON (BA.ID_BEWEGUNG_VEKTOR_POS=VP.ID_BEWEGUNG_VEKTOR_POS)
         LEFT OUTER JOIN JT_BEWEGUNG_VEKTOR  BV ON (VP.ID_BEWEGUNG_VEKTOR=BV.ID_BEWEGUNG_VEKTOR)
         LEFT OUTER JOIN JT_BEWEGUNG_STATION STS ON (STS.ID_BEWEGUNG_ATOM=BA.ID_BEWEGUNG_ATOM AND STS.MENGENVORZEICHEN=-1)
         LEFT OUTER JOIN JT_ADRESSE  ADS ON (STS.ID_ADRESSE=ADS.ID_ADRESSE)
       WHERE BV.ID_BEWEGUNG_VEKTOR = id_vektor
       AND ADS.SONDERLAGER IS NULL
       AND NVL(BA.DELETED,'N')='N'
       AND NVL(BA.STORNIERT,'N')='N'
       ORDER BY VP.POSNR*100000+BA.POSNR ASC;
        
       if (ret is null)  then
         SELECT 
           MIN(BA.ID_BEWEGUNG_ATOM) into ret
         FROM 
           JT_BEWEGUNG_ATOM BA
           LEFT OUTER JOIN JT_BEWEGUNG_VEKTOR_POS  VP  ON (BA.ID_BEWEGUNG_VEKTOR_POS=VP.ID_BEWEGUNG_VEKTOR_POS)
           LEFT OUTER JOIN JT_BEWEGUNG_VEKTOR      BV  ON (VP.ID_BEWEGUNG_VEKTOR=BV.ID_BEWEGUNG_VEKTOR)
           LEFT OUTER JOIN JT_BEWEGUNG_STATION     STS ON (STS.ID_BEWEGUNG_ATOM=BA.ID_BEWEGUNG_ATOM AND STS.MENGENVORZEICHEN=-1)
         WHERE BV.ID_BEWEGUNG_VEKTOR = id_vektor
         AND NVL(BA.DELETED,'N')='N'
         AND NVL(BA.STORNIERT,'N')='N'
         ORDER BY VP.POSNR*100000+BA.POSNR ASC;
        end if;
    
    end if;
    
    RETURN ret;
END;
